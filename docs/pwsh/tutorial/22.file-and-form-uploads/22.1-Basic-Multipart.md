---
layout: default
parent: File and Form Uploads
title: Basic multipart/form-data upload
nav_order: 1
---

# Basic multipart/form-data upload

Parse a simple multipart upload with one text field and one file.

## Full source

File: [`pwsh/tutorial/examples/22-file-and-form-uploads/22.1-basic-multipart.ps1`][22.1-basic-multipart.ps1]

```powershell
{% include examples/pwsh/22.1-basic-multipart.ps1 %}
```

## Step-by-step

1. Logger: Register a console logger for visibility.
2. Server: Create the Kestrun host and bind a listener.
3. Storage: Pick a temporary upload directory under the script folder.
4. Options: Enable SHA-256 hashing for stored files.
5. Route: Add a POST `/upload` route with `Add-KrFormRoute`.
6. Response: Return parsed fields and file metadata as JSON.

## Try it

```powershell
$client = [System.Net.Http.HttpClient]::new()
$content = [System.Net.Http.MultipartFormDataContent]::new()
$content.Add([System.Net.Http.StringContent]::new('Hello'),'note')
$bytes = [System.Text.Encoding]::UTF8.GetBytes('sample file')
$file = [System.Net.Http.ByteArrayContent]::new($bytes)
$file.Headers.ContentType = [System.Net.Http.Headers.MediaTypeHeaderValue]::Parse('text/plain')
$content.Add($file,'file','hello.txt')
$client.PostAsync('http://127.0.0.1:5000/upload', $content).Result.Content.ReadAsStringAsync().Result
```

```bash
curl -F "note=Hello" -F "file=@hello.txt;type=text/plain" http://127.0.0.1:5000/upload
```

## Expected output

```json
{
  "fields": {
    "note": ["Hello"]
  },
  "files": [
    {
      "name": "file",
      "fileName": "hello.txt",
      "contentType": "text/plain",
      "length": 11,
      "sha256": "..."
    }
  ]
}
```

## Notes

- Limits: `KrFormOptions.Limits` controls max request size, part size, and field size.
- Security: Filenames are sanitized and stored in a temporary directory.
- Logging: Parsing events are written through `host.Logger` without logging field values.

## References

- [Add-KrFormRoute][Add-KrFormRoute]
- [New-KrServer][New-KrServer]
- [Add-KrEndpoint][Add-KrEndpoint]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Write-KrJsonResponse][Write-KrJsonResponse]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [Localization](../21.Localization/1.Localization)
Next: [Multiple files (same field name)](./22.2-Multiple-Files)

[22.1-basic-multipart.ps1]: /pwsh/tutorial/examples/22-file-and-form-uploads/22.1-basic-multipart.ps1
[Add-KrFormRoute]: /pwsh/cmdlets/Add-KrFormRoute
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrEndpoint]: /pwsh/cmdlets/Add-KrEndpoint
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Write-KrJsonResponse]: /pwsh/cmdlets/Write-KrJsonResponse
