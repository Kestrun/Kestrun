---
layout: default
parent: File and Form Uploads
title: OpenAPI: file hash upload
nav_order: 15
---

# OpenAPI: file hash upload

Upload a binary file and return MD5/SHA1/SHA256/SHA384/SHA512 hashes with OpenAPI annotations.

## Full source

File: [`pwsh/tutorial/examples/22-file-and-form-uploads/22.15-file-hash-openapi.ps1`][22.15-file-hash-openapi.ps1]

```powershell
{% include examples/pwsh/22.15-File-Hash-OpenAPI.ps1 %}
```

## Step-by-step

1. Logger: Register a console logger for visibility.
2. Server: Create the host and bind a listener.
3. OpenAPI: Add document info and contact metadata.
4. Storage: Set the default upload directory.
5. Model: Define the `FileHashUpload` request and `FileHashResponse` schema components.
6. Limits: Set `KrBindForm.MaxRequestBodyBytes`, `KrBindForm.MaxPartBodyBytes`,
and `KrPart.MaxBytes` to allow large uploads (add `KrBindForm.MaxDecompressedBytesPerPart` when using compression).
7. Route: Declare `/upload-hash` with `[OpenApiPath]` and `[OpenApiRequestBody]`.
8. Docs: Register the OpenAPI route and documentation UIs.
9. Start: Launch the server.

## Try it

```powershell
$filePath = Join-Path $env:TEMP 'upload.bin'
[System.IO.File]::WriteAllBytes($filePath, (1..255))

$client = [System.Net.Http.HttpClient]::new()
$content = [System.Net.Http.MultipartFormDataContent]::new()
$stream = [System.IO.File]::OpenRead($filePath)
$fileContent = [System.Net.Http.StreamContent]::new($stream)
$fileContent.Headers.ContentType = [System.Net.Http.Headers.MediaTypeHeaderValue]::Parse('application/octet-stream')
$content.Add($fileContent, 'file', (Split-Path $filePath -Leaf))

$resp = $client.PostAsync('http://127.0.0.1:5000/upload-hash', $content).Result
$resp.Content.ReadAsStringAsync().Result

$stream.Dispose()
$content.Dispose()
$client.Dispose()
```

```bash
# Upload a binary file
curl -F "file=@upload.bin;type=application/octet-stream" http://127.0.0.1:5000/upload-hash
```

## Troubleshooting

- 400 / Missing file: Ensure the part name is `file` and the payload is `multipart/form-data`.
- 415 / Unsupported Content-Type: Send the file with `application/octet-stream`.
- Request body too large: Increase `KrBindForm.MaxRequestBodyBytes`, `KrBindForm.MaxPartBodyBytes`,
and `KrPart.MaxBytes` (use `KrBindForm.MaxDecompressedBytesPerPart` when using compression).

## References

- [Add-KrOpenApiInfo][Add-KrOpenApiInfo]
- [Add-KrOpenApiContact][Add-KrOpenApiContact]
- [Add-KrOpenApiRoute][Add-KrOpenApiRoute]
- [Add-KrApiDocumentationRoute][Add-KrApiDocumentationRoute]
- [Set-KrServerOptions][Set-KrServerOptions]
- [New-KrServer][New-KrServer]
- [Add-KrEndpoint][Add-KrEndpoint]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Write-KrJsonResponse][Write-KrJsonResponse]
- [OpenApiPath][OpenApiPath]
- [OpenApiResponse][OpenApiResponse]
- [OpenApiRequestBody][OpenApiRequestBody]
- [OpenApiSchemaComponent][OpenApiSchemaComponent]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [OpenAPI: part-level compression](./22.14-Part-Compressed-OpenAPI)
Next: [Form rules: file hash upload](./22.16-File-Hash-Rule)

[22.15-file-hash-openapi.ps1]: /pwsh/tutorial/examples/22-file-and-form-uploads/22.15-file-hash-openapi.ps1
[Add-KrOpenApiInfo]: /pwsh/cmdlets/Add-KrOpenApiInfo
[Add-KrOpenApiContact]: /pwsh/cmdlets/Add-KrOpenApiContact
[Add-KrOpenApiRoute]: /pwsh/cmdlets/Add-KrOpenApiRoute
[Add-KrApiDocumentationRoute]: /pwsh/cmdlets/Add-KrApiDocumentationRoute
[Set-KrServerOptions]: /pwsh/cmdlets/Set-KrServerOptions
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrEndpoint]: /pwsh/cmdlets/Add-KrEndpoint
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Write-KrJsonResponse]: /pwsh/cmdlets/Write-KrJsonResponse
[OpenApiPath]: /pwsh/cmdlets/OpenApiPath
[OpenApiResponse]: /pwsh/cmdlets/OpenApiResponse
[OpenApiRequestBody]: /pwsh/cmdlets/OpenApiRequestBody
[OpenApiSchemaComponent]: /pwsh/cmdlets/OpenApiSchemaComponent
