name: CodeQL (compat)

# Purpose: Provide a legacy-named CodeQL workflow (codeql.yml) so that
# branch protection / code scanning expectations referencing
# ".github/workflows/codeql.yml:analyze" are satisfied. This delegates
# to the existing reusable core workflow so logic duplication is avoided.
# Once protections are updated to rely solely on codeql-pr.yml / codeql-main.yml,
# this file can be removed.

on:
  workflow_call:
  push:
    branches: [main]
    paths:
      - '**/*.cs'
      - '**/*.csproj'
      - '**/*.sln'
      - '**/*.ps1'
      - '**/*.psm1'
      - '**/*.psd1'
      - '**/*.yml'
      - '**/*.yaml'
      - tests/**
  pull_request:
    branches: [main]
    paths:
      - '**/*.cs'
      - '**/*.csproj'
      - '**/*.sln'
      - '**/*.ps1'
      - '**/*.psm1'
      - '**/*.psd1'
      - '**/*.yml'
      - '**/*.yaml'
      - tests/**

permissions:
  contents: read
  pull-requests: read
  actions: read
  security-events: write

jobs:
  analyze:
    name: CodeQL (compat analyze)
    uses: ./.github/workflows/codeql-core.yml
    with:
      is_pr: ${{ github.event_name == 'pull_request' }}
