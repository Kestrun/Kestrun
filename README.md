<!-- markdownlint-disable-file MD041 -->
```text
â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•— â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â• â•šâ•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•
Kestrun â€” PowerShell brains. Kestrel speed.
```

---
<!-- CI / Quality -->
![CI](https://github.com/Kestrun/Kestrun/actions/workflows/ci.yml/badge.svg)
[![CodeQL](https://github.com/kestrun/kestrun/actions/workflows/codeql.yml/badge.svg)](https://github.com/kestrun/kestrun/actions/workflows/codeql.yml)
![ClamAV Scan](https://img.shields.io/github/actions/workflow/status/kestrun/kestrun/clam-av.yml?branch=main&label=ClamAV%20Scan)

<!-- Coverage -->
[![CodeFactor](https://www.codefactor.io/repository/github/kestrun/kestrun/badge/main)](https://www.codefactor.io/repository/github/kestrun/kestrun/overview/main)
[![Coveralls Badge](https://coveralls.io/repos/github/Kestrun/Kestrun/badge.svg?branch=main)](https://coveralls.io/github/Kestrun/Kestrun?branch=main)
[![Coverage Status](https://coverage.kestrun.dev/badge_combined.svg)](https://coverage.kestrun.dev)

<!-- Platforms -->
[![Linux](https://img.shields.io/badge/Linux-Supported-success?logo=linux)](https://github.com/Kestrun/Kestrun/actions)
[![macOS](https://img.shields.io/badge/macOS-Supported-success?logo=apple)](https://github.com/Kestrun/Kestrun/actions)
[![Windows](https://img.shields.io/badge/Windows-Supported-success?logo=windows)](https://github.com/Kestrun/Kestrun/actions)

[![x64](https://img.shields.io/badge/x64-Supported-success?logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHJlY3QgeD0iNiIgeT0iNiIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIiByeD0iMiIgZmlsbD0id2hpdGUiLz48cmVjdCB4PSIxIiB5PSI4IiB3aWR0aD0iNCIgaGVpZ2h0PSIyIiBmaWxsPSJ3aGl0ZSIvPjxyZWN0IHg9IjEiIHk9IjE0IiB3aWR0aD0iNCIgaGVpZ2h0PSIyIiBmaWxsPSJ3aGl0ZSIvPjxyZWN0IHg9IjE5IiB5PSI4IiB3aWR0aD0iNCIgaGVpZ2h0PSIyIiBmaWxsPSJ3aGl0ZSIvPjxyZWN0IHg9IjE5IiB5PSIxNCIgd2lkdGg9IjQiIGhlaWdodD0iMiIgZmlsbD0id2hpdGUiLz48L3N2Zz4=)](https://github.com/Kestrun/Kestrun/actions)
[![Arm64](https://img.shields.io/badge/Arm64-Supported-success?logo=arm)](https://github.com/Kestrun/Kestrun/actions)

[![.NET 8](https://img.shields.io/badge/.NET-8.0-512BD4)](https://dotnet.microsoft.com/download/dotnet/8.0)
[![.NET 9](https://img.shields.io/badge/.NET-9.0-512BD4)](https://dotnet.microsoft.com/download/dotnet/9.0)
[![PowerShell 7.4](https://img.shields.io/badge/PowerShell-7.4-blue)](https://github.com/PowerShell/PowerShell/releases/tag/v7.4.0)
[![PowerShell 7.5](https://img.shields.io/badge/PowerShell-7.5-blue)](https://github.com/PowerShell/PowerShell/releases/tag/v7.5.0)
[![PowerShell 7.6](https://img.shields.io/badge/PowerShell-7.6(preview)-blue)](https://github.com/PowerShell/PowerShell/releases/tag/v7.6.0-preview.4)

![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)
[![Contributions](https://img.shields.io/badge/contributions-welcome-brightgreen.svg)](CONTRIBUTING.md)
[![Releases](https://img.shields.io/github/v/release/Kestrun/Kestrun?display_name=release)](https://github.com/Kestrun/Kestrun/releases)

[![Docs](https://img.shields.io/badge/docs-online-blue)](https://docs.kestrun.dev)
[![NuGet](https://img.shields.io/nuget/v/Kestrun)](https://www.nuget.org/packages/Kestrun/)
[![PowerShell Gallery](https://img.shields.io/powershellgallery/v/Kestrun)](https://www.powershellgallery.com/packages/Kestrun)

Kestrun is a hybrid web framework that combines the speed and scalability of ASP.NET Core (Kestrel) with the
flexibility and scripting power of PowerShell. It enables you to build web APIs, automation endpoints, and
dynamic services using both C# and PowerShell in a single, integrated environment.

## Rich Documentation and Tutorial

Full documentation and tutorial for Kestrun is available online at [docs.kestrun.dev](https://docs.kestrun.dev).
You can find guides, API references, and usage examples to help you get started and explore advanced features.

## Core Capabilities

- **ğŸš€ Fast, cross-platform web server**
  Powered by **ASP.NET Core (Kestrel)** with full access to advanced HTTP/2, header compression, and TLS options.

- **ğŸš Native PowerShell integration**
  Routes can be backed by PowerShell scripts with isolated, pooled **runspaces** and dynamic
  `$Context.Request` / `$Context.Response` variables.

- **ğŸ§  Multi-language script routing**
  Register HTTP routes using:
  - ğŸš PowerShell
  - ğŸ§© C# scripts (Roslyn compiled with typed globals and shared state)
  - ğŸ“„ VB.NET scripts (full .NET scripting with claims and validation support)
  - ğŸ Python (via Python.NET)
  - ğŸ“œ JavaScript (via ClearScript + V8)
  - ğŸ§ª F# (stubbed for future support)

- **ğŸ“„ Razor Pages backed by PowerShell**
  Use `.cshtml + .cshtml.ps1` pairs with automatic `$Model` injection and dynamic rendering via `HttpContext.Items["PageModel"]`.

- **ğŸ“¦ Modular architecture**
  Combine C# libraries, PowerShell modules, Razor views, static files, and custom handlers into a unified web app.

## HTTP & Protocol Support

- **ğŸŒ Rich HTTP support**
  - Routes with query, headers, body support
  - Static files with custom headers, `Content-Disposition`, stream/async send
  - Built-in MIME type detection
  - Charset and compression negotiation

- **ğŸ” TLS/HTTPS & Certificate support**
  - Supports `X509Certificate2` objects directly
  - Fine-grained listener control: `Protocols`, `UseConnectionLogging`, HTTP/1.1 & HTTP/2
  - Hot-swap of certificate or listener settings

- **ğŸ›¡ï¸ Comprehensive Authentication & Authorization**
  - **Multiple authentication schemes**: Windows, Basic, API Key, JWT Bearer, Cookie, Certificate, Negotiate, OpenID Connect
  - **Claims-based authorization**: Rich claim policies with PowerShell and VB.NET claim providers
  - **Route-level authorization**: Fine-grained access control per endpoint
  - **Credential validation**: Supports SecureString utilities and custom validation delegates

## Developer-Focused

- **ğŸ§ª Test-friendly architecture**
  - **C#**: xUnit + script compilation validation (`ValidateCSharpScript`)
  - **PowerShell**: Pester-compatible setup for route and module tests
  - Script diagnostics: line-numbered errors, detailed exception formatting

- **ğŸ§¬ Shared global state**
  A thread-safe, case-insensitive `SharedState` store for global variables, usable across C#, PowerShell, and Razor.

- **ğŸ–¨ï¸ Flexible response output**
  Respond with:
  - `WriteTextResponse`, `WriteJsonResponse`, `WriteXmlResponse`, `WriteYamlResponse`
  - `WriteFileResponse`, `WriteBinaryResponse`, `WriteStreamResponse`
  - Optional `Content-Disposition: inline` / `attachment; filename=â€¦`

- **ğŸ§µ Thread-safe runspace pooling**
  Automatic pooling of PowerShell runspaces with configurable min/max, affinity (`PSThreadOptions`), and module injection.

- **ğŸ“‘ Script validation & compilation error reporting**
  C# route validation returns detailed Roslyn diagnostics without throwing (e.g., for editor integration or CI prechecks).

- **ğŸ§¾ Logging with Serilog**
  - Fluent `KestrunLoggerBuilder` for per-subsystem loggers
  - Named logger registration & retrieval
  - Reset/Reload/Dispose support for hot-reload or graceful shutdowns
  - Default rolling file logs (`logs/kestrun.log`)

## Deployment & Extensibility

- **ğŸ› ï¸ CI/CD ready**
  - Build- and run-time configurable
  - Works in containerized / headless environments
  - Supports Dev/Prod fallback module path detection

- **ğŸ›¡ï¸ Optional Add-ons**
  Add via fluent extensions:
  - `AddAntiforgery()` middleware
  - `AddStaticFiles()`, `AddDefaultFiles()`, `AddFileServer()`
  - `AddCors(policy)` or `AddCorsAllowAll()`
  - `AddSignalR<T>()` for real-time hubs
  - `AddAuthentication()` with multiple schemes (Windows, Basic, JWT, Certificate, etc.)
  - Ready for Swagger, gRPC, custom middleware hooks

- **âš¡ Task Scheduling & Background Jobs**
  - **Cron-based scheduling**: Full cron expression support via Cronos
  - **Multi-language job support**: Schedule PowerShell, C#, and VB.NET scripts as background jobs
  - **Job management**: Start, stop, and monitor scheduled tasks with detailed logging

## Getting Started

### Prerequisites

**For Building:**

- [.NET 8 SDK](https://dotnet.microsoft.com/download) AND [.NET 9 SDK](https://dotnet.microsoft.com/download) (both required)
- **PowerShell 7.4+**
- **Invoke-Build** and **Pester** PowerShell modules:

```powershell
Install-PSResource -Name 'InvokeBuild','Pester' -Scope CurrentUser
```

**For Runtime:**

To run applications built with Kestrun, you need a matching pair of .NET Runtime and PowerShell:

- [.NET 8 Runtime](https://dotnet.microsoft.com/download)
  â†’ Required for **PowerShell 7.4** and **7.5**

- [.NET 9 Runtime](https://dotnet.microsoft.com/download)
  â†’ Required for **PowerShell 7.6 (preview)**

Download PowerShell from [GitHub Releases](https://github.com/PowerShell/PowerShell/releases).

### Build & Run

Clone the repository:

```powershell
git clone https://github.com/Kestrun/Kestrun.git
cd Kestrun
```

Build the solution using Invoke-Build:

```powershell
Invoke-Build Restore ; Invoke-Build Build
```

And then, create a new simple server:

```powershell
# Import the Kestrun module (Dev)
Import-Module ./src/PowerShell/Kestrun/Kestrun.psm1

# Create a new server
New-KrServer -Name 'My first server'

# Enable the server configuration
Enable-KrConfiguration

# Map a route
Add-KrMapRoute -Path '/hello' -ScriptBlock { Write-KrTextResponse "Hello from PowerShell!" }

# Start the server
Start-KrServer
```

Or run a .NET sample (e.g., MultiRoutes):

```powershell
dotnet run --project .\examples\CSharp\MultiRoutes\MultiRoutes.csproj
```

### Using the PowerShell Module

Import the module (from source):

```powershell
Import-Module ./src/PowerShell/Kestrun/Kestrun.psm1
```

## Running Tests

### Using Invoke-Build (Recommended)

The project includes an Invoke-Build script that automatically handles both C# (xUnit) and PowerShell (Pester) tests:

```powershell
Invoke-Build Test
```

### Manual Test Execution

#### C# Tests

```powershell
Invoke-Build Kestrun.Tests
```

#### PowerShell Tests

```powershell
Invoke-Build Test-Pester
```

## Documentation and Tutorial

Kestrun docs are built with [Just-the-Docs](https://github.com/just-the-docs/just-the-docs).
All new documentation **must be compatible** (front matter, `parent`, `nav_order`, etc.).

See [docs/](docs/) for structure.

## Project Structure

- `src/CSharp/` â€” C# core libraries and web server
  - `Kestrun/Authentication` â€” authentication handlers and schemes
  - `Kestrun/Certificates` â€” certificate management utilities
  - `Kestrun/Hosting` â€” host configuration and extensions
  - `Kestrun/Languages` â€” multi-language scripting support (C#, VB.NET, etc.)
  - `Kestrun/Logging` â€” Serilog integration and logging helpers
  - `Kestrun/Middleware` â€” custom middleware components
  - `Kestrun/Models` â€” request/response classes and data models
  - `Kestrun/Razor` â€” Razor Pages integration with PowerShell
  - `Kestrun/Scheduling` â€” task scheduling and background job support
  - `Kestrun/Scripting` â€” script execution and validation
  - `Kestrun/Security` â€” security utilities and helpers
  - `Kestrun/SharedState` â€” thread-safe global state management
  - `Kestrun/Utilities` â€” shared utility functions
- `src/PowerShell/` â€” PowerShell module and scripts
- `examples/` â€” Example projects and demonstrations
  - `CSharp/Authentication` â€” authentication examples
  - `CSharp/Certificates` â€” certificate usage examples
  - `CSharp/HtmlTemplate` â€” HTML templating examples
  - `CSharp/MultiRoutes` â€” multi-route examples
  - `CSharp/RazorSample` â€” Razor Pages examples
  - `CSharp/Scheduling` â€” task scheduling examples
  - `CSharp/SharedState` â€” shared state examples
  - `PowerShell/` â€” PowerShell examples
  - `Files/` â€” test files and resources
- `tests/` â€” Test projects (C#, PowerShell)
- `docs/` â€” Documentation files (Just-the-Docs)
- `Utility/` â€” Build and maintenance scripts
- `.github/` â€” GitHub Actions workflows
- `Lint/` â€” Code analysis rules

## Contributing

Contributions of all sizes are welcome â€” from docs improvements to new feature modules.
See [CONTRIBUTING.md](CONTRIBUTING.md) and the online guide at <https://docs.kestrun.dev/contributing>.

## License

Licensed under the MIT License. See [LICENSE](LICENSE).

## Acknowledgements

### Documentation

- [Just-the-Docs](https://github.com/just-the-docs/just-the-docs) for documentation

### Code Quality

- [ReportGenerator](https://github.com/danielpalme/ReportGenerator) for code coverage reporting
- [codefactor](https://www.codefactor.io/) for code quality analysis
- [coveralls](https://coveralls.io/) for code coverage tracking

### AI Assistance

- [ChatGPT](https://openai.com/chatgpt) for conversational AI support
- [Copilot](https://github.com/features/copilot) for AI-powered code suggestions

### Collaboration and Version Control

- [GitHub](https://github.com/) for version control and collaboration
- [NuGet](https://www.nuget.org/) for package management
- [PowerShell Gallery](https://www.powershellgallery.com/) for PowerShell modules

### Scripting and Automation

- [PowerShell](https://github.com/PowerShell/PowerShell) for scripting and automation
- [.NET](https://dotnet.microsoft.com/) for the underlying framework
- [Pester](https://pester.dev/) for PowerShell testing
