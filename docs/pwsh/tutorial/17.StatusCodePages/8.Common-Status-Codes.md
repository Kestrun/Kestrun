---
title: Common Status Codes
parent: Status Code Pages
nav_order: 8
---

# Common Status Codes

Try common HTTP status codes (401/403/404/405/415/400/422/200/201/204) on a small set of routes.

## Full source

File: [`pwsh/tutorial/examples/17.8-StatusCodePages-Common-Status-Codes.ps1`][17.8-StatusCodePages-Common-Status-Codes.ps1]

```powershell
{% include examples/pwsh/17.8-StatusCodePages-Common-Status-Codes.ps1 %}
```

## Step-by-step

1. Logging: Register a console logger.
2. OpenAPI: Set a title/version and expose OpenAPI routes.
3. 401/403 demo: Configure Basic auth only to trigger real 401/403 responses.
4. Routes: Add endpoints that return 200/201/204 and trigger 400/415/422/405/404.
5. Start: Apply configuration and start the server.

## Try it

```powershell
# 200
curl -i http://127.0.0.1:5000/public

# 401 (no credentials)
curl -i http://127.0.0.1:5000/secure/hello

# 401 (bad credentials)
curl -i -H "Authorization: Basic YWRtaW46d3Jvbmc=" http://127.0.0.1:5000/secure/hello

# 201
curl -i -X POST http://127.0.0.1:5000/json/echo -H "Content-Type: application/json" -d '{"name":"widget","quantity":2,"priority":"normal"}'

# 415 (wrong content type)
curl -i -X POST http://127.0.0.1:5000/json/echo -H "Content-Type: text/plain" -d 'hi'

# 405
curl -i -X POST http://127.0.0.1:5000/only-get

# 404
curl -i http://127.0.0.1:5000/does-not-exist
```

## OpenAPI Contract Enforcement

This sample demonstrates runtime behaviors that can also be represented in generated OpenAPI:

- **415 Unsupported Media Type** when request `Content-Type` does not match declared request body content types.
- **400 Bad Request** for malformed payloads.
- **422 Unprocessable Entity** for validation failures after successful parsing.
- **406 Not Acceptable** when response negotiation cannot satisfy the `Accept` header.

For predictable OpenAPI output, configure the auto-generated error schema before building docs:

```powershell
Set-KrOpenApiErrorSchema -Name 'KestrunErrorResponse' -ContentType @('application/problem+json')
```

This keeps the OpenAPI 4xx response schema/media type aligned with the runtime contract you are exercising in this tutorial.

## Troubleshooting

| Symptom | Likely cause | Fix |
|--------|---------------|-----|
| `401` when you expected `200` on `/secure/hello` | Missing/invalid Authorization header | Send valid Basic auth credentials or try `/public` for a non-auth route |
| `403` on `DELETE /secure/resource/{id}` even with valid credentials | Authenticated user does not meet the `CanDelete` policy | This sample intentionally blocks deletes; use it only to demonstrate `403 Forbidden` |
| `415` from `/json/echo` | `Content-Type` is missing or not `application/json` | Set `-ContentType 'application/json'` (PowerShell) or `-H "Content-Type: application/json"` (curl) |
| `400` from `/json/echo` | Invalid JSON body | Fix JSON syntax and retry |
| `422` from `/json/echo` | JSON is valid but fails validation | Provide `name` and a `quantity` in `1..100` (and omit unknown fields unless using `echoPlus`) |

## References

- [Add-KrBasicAuthentication][Add-KrBasicAuthentication]
- [Write-KrStatusResponse][Write-KrStatusResponse]
- [Write-KrResponse][Write-KrResponse]
- [Add-KrOpenApiRoute][Add-KrOpenApiRoute]
- [Set-KrOpenApiErrorSchema][Set-KrOpenApiErrorSchema]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [Re-execute](./7.Re-execute)
Next: [Exception Handling](../18.ExceptionHandling/index)

[17.8-StatusCodePages-Common-Status-Codes.ps1]: /pwsh/tutorial/examples/17.8-StatusCodePages-Common-Status-Codes.ps1
[Add-KrBasicAuthentication]: /pwsh/cmdlets/Add-KrBasicAuthentication
[Write-KrStatusResponse]: /pwsh/cmdlets/Write-KrStatusResponse
[Write-KrResponse]: /pwsh/cmdlets/Write-KrResponse
[Add-KrOpenApiRoute]: /pwsh/cmdlets/Add-KrOpenApiRoute
[Set-KrOpenApiErrorSchema]: /pwsh/cmdlets/Set-KrOpenApiErrorSchema
