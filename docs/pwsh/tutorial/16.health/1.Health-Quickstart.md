---
title: Health Quickstart
parent: Health
nav_order: 1
---

# Health Endpoint Quickstart

Expose `/healthz` and aggregate basic probes (script + HTTP) into a single JSON document for liveness / readiness checks.
This is the migrated version of the previous Responses chapter entry, now expanded with concepts and
operational notes.

## Full source

File: [`pwsh/tutorial/examples/16.1-Health-Quickstart.ps1`][16.1-Health-Quickstart.ps1]

```powershell
{% include examples/pwsh/16.1-Health-Quickstart.ps1 %}
```

## Concepts

| Term | Meaning |
|------|---------|
| Probe | A unit of health evaluation returning `Status`, `Description`, and optional `Data` |
| Status | `Healthy`, `Degraded`, or `Unhealthy` (optionally escalated if configured) |
| Endpoint | Aggregator that executes selected probes in parallel and shapes the response |
| Tags | Classification labels used to include/exclude probes per request |
| Timeout | Per-probe timeout (endpoint-level default) after which a probe is considered failed |

## Steps (Script Perspective)

1. (Logging) Configure console logger for visibility
2. (Server) Create server & listener (loopback:5000)
3. (Route) Map `/ping` returning a simple status object
4. (Endpoint) Register `/healthz` with: default tag `self`, shorter timeout, and escalate degraded to unhealthy
5. (Probe) Script probe `Self` -> static readiness confirmation
6. (Probe) HTTP probe `Ping` -> validates internal route
7. (Run) Start server; query endpoint

## Response Shape

Typical aggregate (trimmed example):

```json
{
  "status": "Healthy",
  "started": "2025-09-26T10:15:04.1234567Z",
  "durationMs": 37,
  "probes": [
    { "name": "Self", "status": "Healthy", "description": "Main pipeline ready", "durationMs": 0 },
    { "name": "Ping", "status": "Healthy", "durationMs": 15 }
  ]
}
```

Field overview:

- `status`: Worst case across included probes (after any escalation rules)
- `started`: UTC timestamp when execution began
- `durationMs`: Total aggregate wall clock duration
- `probes[]`: Individual probe payloads (implementation-defined data bag may appear)

## Execution Lifecycle

1. Request arrives at `/healthz`
2. Tag filter resolved (query: `tag` / `tags`, fallback to endpoint defaults)
3. Probe list materialized & dispatched concurrently
4. Each probe: run -> map result -> clamp to timeout (canceled => degraded/unhealthy per rules)
5. Aggregate status computed (worst) then escalate if `-TreatDegradedAsUnhealthy`
6. JSON serialized & returned (200 when healthy/degraded unless escalation triggers 503)

## Options Summary

| Option | Script Param | Purpose |
|--------|--------------|---------|
| `-DefaultTags` | Endpoint | Baseline tag set when caller omits `tag(s)` |
| `-ProbeTimeout` | Endpoint | Per-probe timeout & cancellation window |
| `-TreatDegradedAsUnhealthy` | Endpoint | Escalate degraded to unhealthy (for strict readiness) |
| `-Tags` | Probe | Assign classification labels |
| `-Timeout` | Probe (e.g., HTTP/process) | Per-probe override (stronger than endpoint default) |

## Filtering Examples

| Query | Effect |
|-------|--------|
| `?tag=self` | Only `self` probes |
| `?tags=remote,api` | `remote OR api` probes (union – duplicates removed) |
| none | Default endpoint tags (`self`) |

Multiple `tag` parameters are also merged: `?tag=self&tag=remote` ⇒ same as `?tags=self,remote`.

## Failure & Escalation Scenarios

| Scenario | Raw Probe Status | Aggregate (TreatDegradedAsUnhealthy=$true) | HTTP Code |
|----------|------------------|-------------------------------------------|-----------|
| One degraded, others healthy | Degraded | Unhealthy | 503 |
| One unhealthy | Unhealthy | Unhealthy | 503 |
| All healthy | Healthy | Healthy | 200 |
| Timeout (canceled) | Degraded (mapped) | Unhealthy | 503 |

Without escalation the degraded row would remain degraded with 200.

## Try It

```powershell
Invoke-RestMethod http://127.0.0.1:5000/healthz | ConvertTo-Json -Depth 4
Invoke-RestMethod 'http://127.0.0.1:5000/healthz?tag=remote' | ConvertTo-Json -Depth 4
```

## Troubleshooting

| Symptom | Likely Cause | Resolution |
|---------|--------------|-----------|
| Endpoint slow (>1s) | Too many long probes running in parallel | Shorten probe timeout; split into readiness vs diagnostics endpoint |
| Random degraded spikes | Intermittent dependency latency | Add retry inside probe or widen degraded threshold |
| 503 on deployment start | Strict escalation | Temporarily disable `-TreatDegradedAsUnhealthy` during warm-up |
| Missing probe in output | Tag filtering excluded it | Check query tags & default tags |

## Next

Proceed to: [Script Probe](./2.Health-Script-Probe) for custom logic & metrics, then specialized probes (HTTP, Process, C#, Disk).

[16.1-Health-Quickstart.ps1]: /pwsh/tutorial/examples/16.1-Health-Quickstart.ps1
