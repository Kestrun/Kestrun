---
layout: default
parent: Tasks
grand_parent: PowerShell Tutorials
title: Tasks
nav_order: 1
---

# Tasks

Run ad-hoc scripts as background tasks with status, results, and cancellation.

## Full source

File: [`pwsh/tutorial/examples/20.1-Task.ps1`][20.1-Task.ps1]

```powershell
{% include examples/pwsh/20.1-Task.ps1 %}
```

## Step-by-step

1. Logging: Register a console logger and set level to Debug.
2. Server: Create a Kestrun server named "Tasks Demo Server".
3. Listener: Listen on loopback using a self-signed certificate on the provided port (HTTPS).
4. Tasks: Enable the ad-hoc task feature with `Add-KrTasks`.
5. Configure: Call `Enable-KrConfiguration` to build the app.
6. Routes: Map endpoints to create, start, query state/result, cancel, remove, and list tasks.
7. Convenience: Add a one-shot route to create+start a PowerShell task.
8. Start: Run the server asynchronously with `Start-KrServer`.

## Try it

```powershell
$base = 'https://127.0.0.1:5000'

# Create a PowerShell task (does not start)
curl -k -s "$base/tasks/create/ps?seconds=2" | jq

# Create a C# task (does not start)
curl -k -s "$base/tasks/create/cs?ms=1500" | jq

# Start a task by id
$id = 'REPLACE_WITH_ID'
curl -k -s "$base/tasks/start?id=$id" | jq

# Check state and detailed result
curl -k -s "$base/tasks/state?id=$id" | jq
curl -k -s "$base/tasks/result?id=$id" | jq

# Cancel and remove
curl -k -s "$base/tasks/cancel?id=$id" | jq
curl -k -s "$base/tasks/remove?id=$id" | jq

# List all
curl -k -s "$base/tasks/list" | jq
```

PowerShell equivalents (Invoke-WebRequest):

```powershell
$base = 'https://127.0.0.1:5000'

$ps = (Invoke-WebRequest -Uri "$base/tasks/create/ps?seconds=10" -SkipCertificateCheck).Content | ConvertFrom-Json
$id = $ps.id

Invoke-WebRequest -Uri "$base/tasks/start?id=$id" -SkipCertificateCheck | Out-Null
(Invoke-WebRequest -Uri "$base/tasks/state?id=$id" -SkipCertificateCheck).Content | ConvertFrom-Json
(Invoke-WebRequest -Uri "$base/tasks/result?id=$id" -SkipCertificateCheck).Content | ConvertFrom-Json

Invoke-WebRequest -Uri "$base/tasks/list" -SkipCertificateCheck | Select-Object -ExpandProperty Content | ConvertFrom-Json
```

## Key Points

- The Tasks feature supports PowerShell, C#, and VB.NET code.
- Create and start are separate operations for better control; convenience cmdlet `Start-KrTask` does both.
- Results differ by language: PowerShell returns pipeline objects, C#/VB return the last expression value.
- Cancellation cooperates across languages; PowerShell uses `Stop()`, C# accepts a token, VB is awaited cooperatively.

## References

- [Add-KrTasks](/pwsh/cmdlets/Add-KrTasks)
- [New-KrTask](/pwsh/cmdlets/New-KrTask)
- [Start-KrTask](/pwsh/cmdlets/Start-KrTask)
- [Start-KrTask](/pwsh/cmdlets/Start-KrTask)
- [Get-KrTask](/pwsh/cmdlets/Get-KrTask)
- [Get-KrTask](/pwsh/cmdlets/Get-KrTask)
- [Stop-KrTask](/pwsh/cmdlets/Stop-KrTask)
- [Remove-KrTask](/pwsh/cmdlets/Remove-KrTask)
- [Add-KrMapRoute](/pwsh/cmdlets/Add-KrMapRoute)
- [Write-KrJsonResponse](/pwsh/cmdlets/Write-KrJsonResponse)
- [Enable-KrConfiguration](/pwsh/cmdlets/Enable-KrConfiguration)
- [Start-KrServer](/pwsh/cmdlets/Start-KrServer)

---

### Previous / Next

Previous: [_None_](.)
Next: [_None_](.)

[20.1-Task.ps1]: /pwsh/tutorial/examples/20.1-Task.ps1
