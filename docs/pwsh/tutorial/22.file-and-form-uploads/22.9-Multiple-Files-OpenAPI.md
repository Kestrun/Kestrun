---
layout: default
parent: File and Form Uploads
title: OpenAPI: multiple files
nav_order: 9
---

# OpenAPI: multiple files

Describe multiple files under the same field name with OpenAPI.

## Full source

File: [`pwsh/tutorial/examples/22-file-and-form-uploads/22.9-multiple-files-openapi.ps1`][22.9-multiple-files-openapi.ps1]

```powershell
{% include examples/pwsh/22.9-Multiple-Files-OpenAPI.ps1 %}
```

## Step-by-step

1. Logger: Register a console logger for visibility.
2. Server: Create the host and bind a listener.
3. OpenAPI: Add document info and contact metadata.
4. Storage: Set the default upload directory.
5. Model: Define `FilesUpload` with a `KrFilePart[]` and `AllowMultiple = $true`.
6. Route: Declare `/upload` with `[OpenApiPath]` and `[OpenApiRequestBody]`.
7. Docs: Register the OpenAPI route and documentation UIs.
8. Start: Launch the server.

## Try it

```powershell
$client = [System.Net.Http.HttpClient]::new()
$content = [System.Net.Http.MultipartFormDataContent]::new()
$content.Add([System.Net.Http.StringContent]::new('Batch upload'),'note')
$file1 = [System.Net.Http.ByteArrayContent]::new([System.Text.Encoding]::UTF8.GetBytes('file-1'))
$file1.Headers.ContentType = [System.Net.Http.Headers.MediaTypeHeaderValue]::Parse('text/plain')
$content.Add($file1,'files','one.txt')
$file2 = [System.Net.Http.ByteArrayContent]::new([System.Text.Encoding]::UTF8.GetBytes('file-2'))
$file2.Headers.ContentType = [System.Net.Http.Headers.MediaTypeHeaderValue]::Parse('text/plain')
$content.Add($file2,'files','two.txt')
$resp = $client.PostAsync('http://127.0.0.1:5000/upload', $content).Result
$resp.Content.ReadAsStringAsync().Result
```

```bash
curl -F "note=Batch upload" \
  -F "files=@one.txt;type=text/plain" \
  -F "files=@two.txt;type=text/plain" \
  http://127.0.0.1:5000/upload
```

## Troubleshooting

- Only one file returned: Ensure `AllowMultiple = $true` and the field name is `files`.
- 415 / Unsupported Content-Type: Confirm `multipart/form-data` and correct content types.

## References

- [Add-KrOpenApiInfo][Add-KrOpenApiInfo]
- [Add-KrOpenApiContact][Add-KrOpenApiContact]
- [Add-KrOpenApiRoute][Add-KrOpenApiRoute]
- [Add-KrApiDocumentationRoute][Add-KrApiDocumentationRoute]
- [Set-KrServerOptions][Set-KrServerOptions]
- [New-KrServer][New-KrServer]
- [Add-KrEndpoint][Add-KrEndpoint]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Write-KrJsonResponse][Write-KrJsonResponse]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [OpenAPI: basic multipart upload](./22.8-Basic-Multipart-OpenAPI)
Next: [OpenAPI: urlencoded forms](./22.10-Url-Encoded-OpenAPI)

[22.9-multiple-files-openapi.ps1]: /pwsh/tutorial/examples/22-file-and-form-uploads/22.9-multiple-files-openapi.ps1
[Add-KrOpenApiInfo]: /pwsh/cmdlets/Add-KrOpenApiInfo
[Add-KrOpenApiContact]: /pwsh/cmdlets/Add-KrOpenApiContact
[Add-KrOpenApiRoute]: /pwsh/cmdlets/Add-KrOpenApiRoute
[Add-KrApiDocumentationRoute]: /pwsh/cmdlets/Add-KrApiDocumentationRoute
[Set-KrServerOptions]: /pwsh/cmdlets/Set-KrServerOptions
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrEndpoint]: /pwsh/cmdlets/Add-KrEndpoint
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Write-KrJsonResponse]: /pwsh/cmdlets/Write-KrJsonResponse
