---
title: Component Schemas
parent: OpenApi
nav_order: 2
---

# Component Schemas

Define reusable request and response schemas using PowerShell classes decorated with OpenAPI attributes.

## Full source

File: [`pwsh/tutorial/examples/10.2-OpenAPI-Component-Schema.ps1`][10.2-OpenAPI-Component-Schema.ps1]

```powershell
{% include examples/pwsh/10.2-OpenAPI-Component-Schema.ps1 %}
```

## Step-by-step

1. Logging: Register console logger as default.
2. Server: Create server named 'OpenAPI Component Schema'.
3. OpenAPI info: Add title, version, and description.
4. Primitive schema components: Define reusable primitives (`Date`, `Money`, `EmployeeId`) by inheriting from `OpenApiDate`, `OpenApiNumber`, and `OpenApiUuid`.
5. Object schemas: Define `PersonBase` → `Person` → `Employee` → `EmployeeResponse` to demonstrate inheritance-based `allOf` composition.
6. Array wrappers: Define `Dates`, `EmployeeList`, and `LineItemList` to model arrays as components (`Array = $true`).
7. Routes: Map `GET /employees` (returns `EmployeeList`) and `POST /tickets/purchase` (accepts `PurchaseRequest`, returns `PurchaseResponse`, errors as `ErrorResponse`).
8. Build and validate OpenAPI document, then start server.

## Try it

```powershell
# List employees
curl -i http://127.0.0.1:5000/employees

# Purchase tickets (POST with PurchaseRequest)
curl -i -X POST http://127.0.0.1:5000/tickets/purchase `
  -H "Content-Type: application/json" `
  -d '{
    "customer": {
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane.smith@example.com"
    },
    "items": [
      { "ticketType": "general", "quantity": 2, "unitPrice": 25.0 }
    ],
    "visitDates": ["2026-01-14"],
    "note": "Please email the receipt."
  }'

# View the OpenAPI specification
curl http://127.0.0.1:5000/openapi/v3.1/openapi.json | ConvertFrom-Json | ConvertTo-Json
```

PowerShell equivalent for POST:

```powershell
$body = @{
    customer = @{
        firstName = 'Jane'
        lastName  = 'Smith'
        email     = 'jane.smith@example.com'
    }
    items = @(
        @{ ticketType = 'general'; quantity = 2; unitPrice = 25.0 }
    )
    visitDates = @('2026-01-14')
    note = 'Please email the receipt.'
} | ConvertTo-Json

Invoke-WebRequest -Uri http://127.0.0.1:5000/tickets/purchase `
    -Method Post `
    -ContentType 'application/json' `
    -Body $body | Select-Object StatusCode, Content
```

## Schema Component Attributes

```powershell
[OpenApiSchemaComponent(Description = 'A calendar date (YYYY-MM-DD).', Example = '2026-01-13')]
class Date : OpenApiDate {}

[OpenApiSchemaComponent(Description = 'List of employees.', Array = $true)]
class EmployeeList : EmployeeResponse {}
```

- **RequiredProperties**: Comma-separated field names that must be present.
- **Description**: Markdown-formatted component description.
- **OpenApiPropertyAttribute**: Decorates individual properties with constraints (Example, Format, MinLength, MaxLength, Pattern, etc.).

## Key Concepts

- **Request schema components**: Define reusable payload shapes with `[OpenApiSchemaComponent]`.
- **RequestBody linking**: This sample uses `[OpenApiRequestBodyComponent]` + `[OpenApiRequestBodyRef]` to document the purchase payload without requiring
a custom parameter type at runtime.
- **Response schema components**: Define reusable response payloads and reference them from `[OpenApiResponse]`.
- **Primitive schema components**: Create named primitives by inheriting from OpenApi wrapper types (e.g. `OpenApiDate`, `OpenApiNumber`, `OpenApiUuid`).
- **Array wrapper components**: Model arrays as reusable components using `Array = $true` and inheritance.
- **Inheritance and `allOf`**: Base/derived classes become OpenAPI `allOf` compositions, helping you reuse and extend schemas cleanly.
- **Multiple content types**: The purchase endpoint documents `application/json`, `application/xml`, `application/yaml`, and `application/x-www-form-urlencoded`.

### Attribute decoration cheatsheet

- `[OpenApiPath]`: Declares the route/verb and wires the function into OpenAPI generation.
- `[OpenApiResponse]`: Documents each status code, description, schema, and content types.
- `[OpenApiRequestBodyRef]`: References a reusable request body component.
- `[OpenApiSchemaComponent]` / `[OpenApiPropertyAttribute]`: Define reusable schemas and property metadata (description, format, examples, validation ranges/sets).

## Troubleshooting

**Issue**: Schema component not appearing in OpenAPI spec.

- **Solution**: Ensure the class has `[OpenApiSchemaComponent()]` attribute and is referenced in a request body or response.

**Issue**: Required fields validation not working.

- **Solution**: Add `RequiredProperties = ('field1', 'field2')` parameter to `[OpenApiSchemaComponent()]` attribute.

**Issue**: Write-KrResponse returns wrong content type.

- **Solution**: Verify Accept header in request matches one of the `ContentType` values in `[OpenApiResponse]` attribute.

## References

- [OpenApiSchemaComponent][OpenApiSchemaComponent]
- [OpenApiPropertyAttribute][OpenApiPropertyAttribute]
- [OpenApiRequestBodyComponent][OpenApiRequestBodyComponent]
- [OpenApiRequestBodyRef][OpenApiRequestBodyRef]
- [OpenApiResponse][OpenApiResponse]
- [OpenApiPath][OpenApiPath]
- [Add-KrOpenApiInfo][Add-KrOpenApiInfo]
- [Build-KrOpenApiDocument][Build-KrOpenApiDocument]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [Hello World](./1.Hello-World.md)
Next: [RequestBody Components](./3.RequestBody-Components.md)

[OpenApiSchemaComponent]: /pwsh/cmdlets/OpenApiSchemaComponent
[OpenApiPropertyAttribute]: /pwsh/cmdlets/OpenApiPropertyAttribute
[OpenApiRequestBodyComponent]: /pwsh/cmdlets/OpenApiRequestBodyComponent
[OpenApiRequestBodyRef]: /pwsh/cmdlets/OpenApiRequestBodyRef
[OpenApiResponse]: /pwsh/cmdlets/OpenApiResponse
[OpenApiPath]: /pwsh/cmdlets/OpenApiPath
[Add-KrOpenApiInfo]: /pwsh/cmdlets/Add-KrOpenApiInfo
[Build-KrOpenApiDocument]: /pwsh/cmdlets/Build-KrOpenApiDocument
